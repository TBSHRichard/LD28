<!DOCTYPE html>

<html>
	<head>
		<title>LD48 #28 (You Only Get One): Archerilles' Heel</title>
		<!-- Library CDNs -->
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="http://code.createjs.com/createjs-2013.09.25.min.js"></script>
		
		<!-- Class includes -->
		<script type="text/javascript" src="src/MathHelper.js"></script>
		<script type="text/javascript" src="src/GlobalControls.js"></script>
		<script type="text/javascript" src="src/Preloader.js"></script>
		<script type="text/javascript" src="src/IconButton.js"></script>
		<script type="text/javascript" src="src/IconButtonContainer.js"></script>
		<script type="text/javascript" src="src/Archerilles.js"></script>
		<script type="text/javascript" src="src/Arrow.js"></script>
		<script type="text/javascript" src="src/GameView.js"></script>
		
		<!-- Main execution -->
		<script type="text/javascript">
			var stage;
			var preloaderQueue;
			var assetQueue;
			var isReady = false;
			var bgColor = "#fff";
			var currentView;
			
			$(document).ready(function() {
				stage = new createjs.Stage("game-canvas");
				
				if (createjs.Touch.isSupported)
					createjs.Touch.enable(stage);
				
				var background = new createjs.Shape();
				background.graphics.beginFill(bgColor).drawRect(0, 0, stage.canvas.width, stage.canvas.height);
				stage.addChild(background);
				
				preloaderQueue = new createjs.LoadQueue();
				preloaderQueue.loadFile({id: "logo", src: "assets/images/tbsh.png"});
				preloaderQueue.addEventListener("complete", startPreloader);
			});
	
			/*var isRotatingCCW = false;
			var isRotatingCW = false;
			
			$(document).keydown(function(event) {
				if (isReady) {
					switch(event.which) {
						case 65: // A
							isRotatingCCW = true;
							break;
						case 68: // D
							isRotatingCW = true;
							break;
						case 70: // F
							currentView.fireArrow();
							break;
					}
				}
			}).keyup(function(event) {
				if (isReady) {
					switch(event.which) {
						case 65: // A
							isRotatingCCW = false;
							break;
						case 68: // D
							isRotatingCW = false;
							break;
					}
				}
			});*/
			
			function startPreloader() {
				var preloader = new Preloader(stage.canvas.width, stage.canvas.height, preloaderQueue.getResult("logo"), function() {
					assetQueue = preloader.getAssetQueue();
					stage.removeChild(preloader);
					loadedAssets();
				});
				
				stage.addChild(preloader);
				
				createjs.Ticker.addEventListener("tick", stage);
			
				/*createjs.Ticker.addEventListener("tick", function() {
					if (isRotatingCCW) {
						currentView.rotateCCW();
					}
					
					if (isRotatingCW) {
						currentView.rotateCW();
					}
					
					stage.update();
				});*/
			}
			
			function loadedAssets() {
				isReady = true;
				
				currentView = new GameView(stage.canvas.width, stage.canvas.height, assetQueue)
				GlobalControls.setView(currentView);
				stage.addChild(currentView);
			}
		</script>
	</head>
	
	<body style="background-color: #000">
		<canvas id="game-canvas" width="544" height="306">
			You must use a browser which supports canvas in order to play.
		</canvas>
	</body>
</html>